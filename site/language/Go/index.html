
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="开发知识wiki">
      
      
        <meta name="author" content="tink">
      
      
        <link rel="canonical" href="https://docs.cyub.vip/dev-wiki/language/Go/">
      
      
        <link rel="prev" href="../../container/namespace/">
      
      
        <link rel="next" href="../../jupyter/Go-Frameworks-Github-Fork-Stats/">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>Go - 开发知识wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Code";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config",""),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#go" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="开发知识wiki" class="md-header__button md-logo" aria-label="开发知识wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            开发知识wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Go
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  简介

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../computer-system/io/" class="md-tabs__link">
          
  
    
  
  操作系统

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../computer-network/tcp/" class="md-tabs__link">
          
  
    
  
  计算机网络

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../database/mysql/%E7%AE%80%E4%BB%8B/" class="md-tabs__link">
          
  
    
  
  数据库

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../cache/" class="md-tabs__link">
        
  
    
  
  缓存系统

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../container/install/" class="md-tabs__link">
          
  
    
  
  容器

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  开发语言

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../jupyter/Go-Frameworks-Github-Fork-Stats/" class="md-tabs__link">
          
  
    
  
  Jupyter

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../qa/redis/" class="md-tabs__link">
          
  
    
  
  QA

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="开发知识wiki" class="md-nav__button md-logo" aria-label="开发知识wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    开发知识wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    简介
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    操作系统
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            操作系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computer-system/io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computer-system/proc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    proc文件系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computer-system/nptl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NPTL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computer-system/command/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常用命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computer-system/systemtap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Systemtap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computer-system/cpu-arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPU架构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computer-system/compiling-linux-kernel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译Linux内核
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
          
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../computer-network/tcp/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    计算机网络
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            计算机网络
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../computer-network/http/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    数据库
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            数据库
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    mysql
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            mysql
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/mysql/%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    概览
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/mysql/%E4%BA%8B%E5%8A%A1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    事务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/mysql/%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    索引
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/mysql/FAQ/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../database/elasticsearch/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Elasticsearch
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Elasticsearch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/elasticsearch/memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内存占用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/elasticsearch/performance_tuning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    性能调优
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/elasticsearch/production_configuring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    生产配置参考
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/elasticsearch/doc_values_and_fielddata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docs value与 field data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../database/redis/redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    缓存系统
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    容器
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            容器
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../container/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../container/image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    镜像
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../container/cgroup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cgroup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../container/namespace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    namespace
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    开发语言
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            开发语言
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Go
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Go
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#go" class="md-nav__link">
    如何评价Go语言？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gogmp" class="md-nav__link">
    Go的调度机制（GMP模型）
  </a>
  
    <nav class="md-nav" aria-label="Go的调度机制（GMP模型）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gmp" class="md-nav__link">
    GMP指的是什么？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gmp_1" class="md-nav__link">
    GMP调度流程
  </a>
  
    <nav class="md-nav" aria-label="GMP调度流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#work-stealing" class="md-nav__link">
    work stealing 机制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hand-off" class="md-nav__link">
    hand off 机制
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gmp_2" class="md-nav__link">
    GMP 调度过程中存在哪些阻塞?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gmp-p" class="md-nav__link">
    GMP 中为什么需要P?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go_1" class="md-nav__link">
    Go中协作式抢占式调度存在的问题，以及后面如何解决了？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysmon" class="md-nav__link">
    Sysmon 有什么作用?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defer" class="md-nav__link">
    defer 语法特点有哪些，底层实现机制？
  </a>
  
    <nav class="md-nav" aria-label="defer 语法特点有哪些，底层实现机制？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    概念
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    适用场景
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select可以用于做什么?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    映射
  </a>
  
    <nav class="md-nav" aria-label="映射">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mapmap" class="md-nav__link">
    map是否是并发安全的，如何实现顺序读取，如何实现并发的map?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapkeymap" class="md-nav__link">
    map中底层设计的知识点，key长度过长会不会影响map的读写效率？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncmap" class="md-nav__link">
    sync.Map的适合场景，如果是写多读少且支持并发怎么设计？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncmutexmapmap" class="md-nav__link">
    为什么不使用sync.Mutex+map实现并发的map呢？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    通道
  </a>
  
    <nav class="md-nav" aria-label="通道">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel" class="md-nav__link">
    channel有哪几种类型？有哪些特点？底层数据是怎么样的？是否是并发安全的，以及怎么做到并发安全的？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cap" class="md-nav__link">
    内置的cap函数可以用于哪些内容？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-close" class="md-nav__link">
    为啥 channel 会有 close 这个操作, 在哪些场景下会用到这个操作 ?
  </a>
  
    <nav class="md-nav" aria-label="为啥 channel 会有 close 这个操作, 在哪些场景下会用到这个操作 ?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#close" class="md-nav__link">
    使用 close 的场景
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    示例：数据处理和广播信号
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_2" class="md-nav__link">
    Go如何避免内存的对象频繁分配和回收的问题？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_3" class="md-nav__link">
    Go如何进行并发竞态检测，如何避免竞态问题？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    如何实现循环队列？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    锁
  </a>
  
    <nav class="md-nav" aria-label="锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    锁种类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncmutex" class="md-nav__link">
    sync.Mutex的工作模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rwmutex" class="md-nav__link">
    RWMutex实现原理？以及在使用过程中需要注意事项？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#syncwaitgroup" class="md-nav__link">
    sync.WaitGroup用法以及实现原理？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synconce" class="md-nav__link">
    sync.Once用法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cas" class="md-nav__link">
    什么是CAS?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#syncpool" class="md-nav__link">
    sync.Pool的用法以及实现原理？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    如何避免死锁？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_4" class="md-nav__link">
    Go中内存逃逸是怎么回事？怎么检测内存逃逸？有哪些内存逃逸的场景？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    实现一个并发安全的set？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    主协程如何等其余协程完再操作?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#struct" class="md-nav__link">
    struct结构能不能比较？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_5" class="md-nav__link">
    Go里面的值传递和指针传递？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    context包的用途？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    字符串有哪几种拼接方式？性能怎么样？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-c" class="md-nav__link">
    Go 数组与C语言数组有什么区别？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slicelencap" class="md-nav__link">
    slice的len,cap知识，底层共享等问题，以及扩容策略？
  </a>
  
    <nav class="md-nav" aria-label="slice的len,cap知识，底层共享等问题，以及扩容策略？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    切片概念
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    创建方式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reslice" class="md-nav__link">
    reslice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    扩容策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    常见用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-copy" class="md-nav__link">
    字符串与切片内存zero-copy转换的实现？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#makenew" class="md-nav__link">
    make与new的区别？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nil" class="md-nav__link">
    nil 的概念
  </a>
  
    <nav class="md-nav" aria-label="nil 的概念">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go_6" class="md-nav__link">
    Go语言中指针与非安全指针类型概念？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    三色标记法原理
  </a>
  
    <nav class="md-nav" aria-label="三色标记法原理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gc" class="md-nav__link">
    GC流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gc_1" class="md-nav__link">
    GC触发时机
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gc_2" class="md-nav__link">
    辅助GC的目的是？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gc_3" class="md-nav__link">
    GC如何调优
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reflect" class="md-nav__link">
    reflect反射三定律？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-pprof" class="md-nav__link">
    Go pprof
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_7" class="md-nav__link">
    Go内存分配原理？
  </a>
  
    <nav class="md-nav" aria-label="Go内存分配原理？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go_8" class="md-nav__link">
    Go错误处理
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gojavatry-catch" class="md-nav__link">
    Go错误处理机制为啥不采用Java的try-catch的异常机制？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_9" class="md-nav__link">
    Go为什么采用组合机制而不是使用继承机制？
  </a>
  
    <nav class="md-nav" aria-label="Go为什么采用组合机制而不是使用继承机制？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go_10" class="md-nav__link">
    为什么 Go 没有传统的继承？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go_11" class="md-nav__link">
    Go 如何实现多态？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedded-struct" class="md-nav__link">
    Embedded Struct 算不算继承？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    传统继承的问题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-channel-java-blockingqueue" class="md-nav__link">
    Go 中 channel 跟 Java 中 BlockingQueue 又有啥区别 ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-blockingqueue" class="md-nav__link">
    Channel 与 BlockingQueue 的区别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vs-channel" class="md-nav__link">
    共享内存并发 vs. Channel 并发
  </a>
  
    <nav class="md-nav" aria-label="共享内存并发 vs. Channel 并发">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    共享内存并发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel_1" class="md-nav__link">
    Channel 并发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    选择建议
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    资料
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Jupyter
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Jupyter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyter/Go-Frameworks-Github-Fork-Stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Go-Frameworks-Github-Fork-Stats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyter/Pandas%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pandas完全指南
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Spark上手示例
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Spark上手示例
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyter/Spark%E4%B8%8A%E6%89%8B%E7%A4%BA%E4%BE%8B1%EF%BC%9ARDD%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark上手示例1：RDD操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyter/Spark%E4%B8%8A%E6%89%8B%E7%A4%BA%E4%BE%8B2%EF%BC%9ADataFrame%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark上手示例2：DataFrame操作
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    QA
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            QA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/mysql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mysql
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/tcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tcp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/http/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    http
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    缓存
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/queue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    消息队列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/protobuf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    protobuf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/go/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    go
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/dist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分布式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/es/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elasticsearch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../qa/ref/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    参考资料
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#go" class="md-nav__link">
    如何评价Go语言？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gogmp" class="md-nav__link">
    Go的调度机制（GMP模型）
  </a>
  
    <nav class="md-nav" aria-label="Go的调度机制（GMP模型）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gmp" class="md-nav__link">
    GMP指的是什么？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gmp_1" class="md-nav__link">
    GMP调度流程
  </a>
  
    <nav class="md-nav" aria-label="GMP调度流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#work-stealing" class="md-nav__link">
    work stealing 机制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hand-off" class="md-nav__link">
    hand off 机制
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gmp_2" class="md-nav__link">
    GMP 调度过程中存在哪些阻塞?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gmp-p" class="md-nav__link">
    GMP 中为什么需要P?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go_1" class="md-nav__link">
    Go中协作式抢占式调度存在的问题，以及后面如何解决了？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysmon" class="md-nav__link">
    Sysmon 有什么作用?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defer" class="md-nav__link">
    defer 语法特点有哪些，底层实现机制？
  </a>
  
    <nav class="md-nav" aria-label="defer 语法特点有哪些，底层实现机制？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    概念
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    适用场景
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select可以用于做什么?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    映射
  </a>
  
    <nav class="md-nav" aria-label="映射">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mapmap" class="md-nav__link">
    map是否是并发安全的，如何实现顺序读取，如何实现并发的map?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapkeymap" class="md-nav__link">
    map中底层设计的知识点，key长度过长会不会影响map的读写效率？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncmap" class="md-nav__link">
    sync.Map的适合场景，如果是写多读少且支持并发怎么设计？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncmutexmapmap" class="md-nav__link">
    为什么不使用sync.Mutex+map实现并发的map呢？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    通道
  </a>
  
    <nav class="md-nav" aria-label="通道">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel" class="md-nav__link">
    channel有哪几种类型？有哪些特点？底层数据是怎么样的？是否是并发安全的，以及怎么做到并发安全的？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cap" class="md-nav__link">
    内置的cap函数可以用于哪些内容？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-close" class="md-nav__link">
    为啥 channel 会有 close 这个操作, 在哪些场景下会用到这个操作 ?
  </a>
  
    <nav class="md-nav" aria-label="为啥 channel 会有 close 这个操作, 在哪些场景下会用到这个操作 ?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#close" class="md-nav__link">
    使用 close 的场景
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    示例：数据处理和广播信号
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_2" class="md-nav__link">
    Go如何避免内存的对象频繁分配和回收的问题？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_3" class="md-nav__link">
    Go如何进行并发竞态检测，如何避免竞态问题？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    如何实现循环队列？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    锁
  </a>
  
    <nav class="md-nav" aria-label="锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    锁种类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncmutex" class="md-nav__link">
    sync.Mutex的工作模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rwmutex" class="md-nav__link">
    RWMutex实现原理？以及在使用过程中需要注意事项？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#syncwaitgroup" class="md-nav__link">
    sync.WaitGroup用法以及实现原理？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synconce" class="md-nav__link">
    sync.Once用法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cas" class="md-nav__link">
    什么是CAS?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#syncpool" class="md-nav__link">
    sync.Pool的用法以及实现原理？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    如何避免死锁？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_4" class="md-nav__link">
    Go中内存逃逸是怎么回事？怎么检测内存逃逸？有哪些内存逃逸的场景？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    实现一个并发安全的set？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    主协程如何等其余协程完再操作?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#struct" class="md-nav__link">
    struct结构能不能比较？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_5" class="md-nav__link">
    Go里面的值传递和指针传递？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    context包的用途？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    字符串有哪几种拼接方式？性能怎么样？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-c" class="md-nav__link">
    Go 数组与C语言数组有什么区别？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slicelencap" class="md-nav__link">
    slice的len,cap知识，底层共享等问题，以及扩容策略？
  </a>
  
    <nav class="md-nav" aria-label="slice的len,cap知识，底层共享等问题，以及扩容策略？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    切片概念
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    创建方式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reslice" class="md-nav__link">
    reslice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    扩容策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    常见用法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-copy" class="md-nav__link">
    字符串与切片内存zero-copy转换的实现？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#makenew" class="md-nav__link">
    make与new的区别？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nil" class="md-nav__link">
    nil 的概念
  </a>
  
    <nav class="md-nav" aria-label="nil 的概念">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go_6" class="md-nav__link">
    Go语言中指针与非安全指针类型概念？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    三色标记法原理
  </a>
  
    <nav class="md-nav" aria-label="三色标记法原理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gc" class="md-nav__link">
    GC流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gc_1" class="md-nav__link">
    GC触发时机
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gc_2" class="md-nav__link">
    辅助GC的目的是？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gc_3" class="md-nav__link">
    GC如何调优
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reflect" class="md-nav__link">
    reflect反射三定律？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-pprof" class="md-nav__link">
    Go pprof
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_7" class="md-nav__link">
    Go内存分配原理？
  </a>
  
    <nav class="md-nav" aria-label="Go内存分配原理？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go_8" class="md-nav__link">
    Go错误处理
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gojavatry-catch" class="md-nav__link">
    Go错误处理机制为啥不采用Java的try-catch的异常机制？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go_9" class="md-nav__link">
    Go为什么采用组合机制而不是使用继承机制？
  </a>
  
    <nav class="md-nav" aria-label="Go为什么采用组合机制而不是使用继承机制？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go_10" class="md-nav__link">
    为什么 Go 没有传统的继承？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go_11" class="md-nav__link">
    Go 如何实现多态？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedded-struct" class="md-nav__link">
    Embedded Struct 算不算继承？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    传统继承的问题
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-channel-java-blockingqueue" class="md-nav__link">
    Go 中 channel 跟 Java 中 BlockingQueue 又有啥区别 ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-blockingqueue" class="md-nav__link">
    Channel 与 BlockingQueue 的区别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vs-channel" class="md-nav__link">
    共享内存并发 vs. Channel 并发
  </a>
  
    <nav class="md-nav" aria-label="共享内存并发 vs. Channel 并发">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    共享内存并发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel_1" class="md-nav__link">
    Channel 并发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    选择建议
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    资料
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Go</h1>

<h2 id="go">如何评价Go语言？<a class="headerlink" href="#go" title="Permanent link">&para;</a></h2>
<ul>
<li>简洁<ul>
<li>语法简洁，没有传统语言的继承，try-catch异常处理机制</li>
<li>并发编程模式简单，通过通道控制</li>
<li>但支持类型断言，泛型(1.18开始)</li>
</ul>
</li>
<li>并发<ul>
<li>采用混合调度模型</li>
<li>采用通道进行数据同步</li>
</ul>
</li>
<li>内存安全<ul>
<li>自带垃圾回收功能</li>
</ul>
</li>
<li>良好的工具生态<ul>
<li>自带格式化工具</li>
<li>内置性能调优诊断工具</li>
</ul>
</li>
</ul>
<h2 id="gogmp">Go的调度机制（GMP模型）<a class="headerlink" href="#gogmp" title="Permanent link">&para;</a></h2>
<h3 id="gmp">GMP指的是什么？<a class="headerlink" href="#gmp" title="Permanent link">&para;</a></h3>
<ul>
<li>G（Goroutine）：Goroutine，即协程，为用户级的轻量级线程，每个 Goroutine对象中的 sched 保存着其上下文信息(sp、pc等信息）。G是参与调度与执行的最小单位，是并发的关键。</li>
<li>M（Machine）：是对内核级线程的抽象封装。M负责执行G。</li>
<li>P（Processor）：即为 G 和 M 的调度对象，用来调度 G 和 M 之间的关联关系，其数量可通过 GOMAXPROCS()或者GOMAXPROC环境变量来设置，默认为核心数。Linux中P的数量是通过CPU亲和性的系统调用获取。每个P都拥有一个本地可运行G的队列(Local ruanble queue，简称为LRQ)，该队列最多可存放256个G。P的runnext字段也存放了一个G，属于快速路径。</li>
</ul>
<h3 id="gmp_1">GMP调度流程<a class="headerlink" href="#gmp_1" title="Permanent link">&para;</a></h3>
<ul>
<li>每个P有个局部队列(LRQ)，局部队列保存待执行的goroutine(流程2)，当M绑定的P的的局部队列已经满了之后就会把goroutine放到全局队列(流程2-1)</li>
<li>每个P和一个M绑定，<strong>M是真正的执行P中goroutine的实体(流程3)</strong> ，M从绑定的P中的局部队列获取G来执行</li>
<li>当M绑定的P的局部队列为空时，M会从全局队列获取到本地队列来执行G(流程3.1)，当从全局队列中没有获取到可执行的G时候，M会从其他P的局部队列中偷取G来执行(流程3.2)，这种从其他P偷的方式称为**work stealing**</li>
<li>当G因系统调用阻塞(属于系统调用阻塞）时会阻塞M，此时P会和M解绑即**hand off**，并寻找新的idle的M，若没有idle的M就会新建一个M(流程5.1)</li>
<li>当G因channel(属于用户态阻塞)或者network I/O阻塞时，不会阻塞M，M会寻找其他runnable的G；当阻塞的G恢复后会重新进入runnable进入P队列等待执行(流程5.3)</li>
</ul>
<h4 id="work-stealing">work stealing 机制<a class="headerlink" href="#work-stealing" title="Permanent link">&para;</a></h4>
<p>获取 P 本地队列，当从绑定 P 本地 runq 上找不到可执行的 g，尝试从全局链表中拿，再拿不到从 netpoll 和事件池里拿，最后会从别的 P 里偷任务。P此时去唤醒一个 M。P 继续执行其它的程序。M 寻找是否有空闲的 P，如果有则将该 G 对象移动到它本身。接下来 M 执行一个调度循环（调用 G 对象-&gt;执行-&gt;清理线程→继续找新的 Goroutine 执行）。可以看出来work stealing机制包含了两阶段调度模型。</p>
<h4 id="hand-off">hand off 机制<a class="headerlink" href="#hand-off" title="Permanent link">&para;</a></h4>
<p>当本线程 M 因为 G 进行的系统调用阻塞时，线程释放绑定的 P，把 P 转移给其他空闲的 M 执行。</p>
<p>细节：当发生上线文切换时，需要对执行现场进行保护，以便下次被调度执行时进行现场恢复。Go 调度器 M 的栈保存在 G 对象上，只需要将 M 所需要的寄存器（SP、PC 等）保存到 G 对象上就可以实现现场保护。当这些寄存器数据被保护起来，就随时可以做上下文切换了，在中断之前把现场保存起来。如果此时G 任务还没有执行完，M 可以将任务重新丢到 P 的任务队列，等待下一次被调度执行。当再次被调度执行时，M 通过访问 G 的 vdsoSP、vdsoPC 寄存器进行现场恢复（从上次中断位置继续执行）。</p>
<h3 id="gmp_2">GMP 调度过程中存在哪些阻塞?<a class="headerlink" href="#gmp_2" title="Permanent link">&para;</a></h3>
<ul>
<li>I/O（其中网络层级IO已经实现用户级阻塞，不会handleoff M)</li>
<li>block on syscall（系统级阻塞，会handoff M)</li>
<li>channel/select(用户级阻塞)</li>
<li>等待锁</li>
<li>runtime.Gosched() (主动handoff M)</li>
</ul>
<h3 id="gmp-p">GMP 中为什么需要P?<a class="headerlink" href="#gmp-p" title="Permanent link">&para;</a></h3>
<p>GM 调度存在的问题：</p>
<ol>
<li>单一全局互斥锁（Sched.Lock）和集中状态存储</li>
<li>Goroutine 传递问题（M 经常在 M 之间传递”可运行”的 goroutine）</li>
<li>每个 M 做内存缓存，导致内存占用过高，数据局部性较差</li>
<li>频繁 syscall 调用，导致严重的线程阻塞/解锁，加剧额外的性能损耗</li>
</ol>
<h3 id="go_1">Go中协作式抢占式调度存在的问题，以及后面如何解决了？<a class="headerlink" href="#go_1" title="Permanent link">&para;</a></h3>
<p>Go1.14 版本之前，Gorountine需要栈分裂时候，才能触发调度。这种方式存在问题有：</p>
<ul>
<li>某些 Goroutine 可以长时间占用线程，造成其它 Goroutine 的饥饿（比如for循环）</li>
<li>垃圾回收需要暂停整个程序（Stop-the-world，STW），最长可能需要几分钟的时间，导致整个程序无法工作。</li>
</ul>
<p>Go1.14之后开始支持基于信号的抢占式调度。为了防止执行信号的handle函数，发生栈溢出，每个Goroutine都有一个专门的信号栈。从细节来看具体原因是go1.14和go.1.13的调度器有一定的不同。</p>
<p>两者都支持抢占式调度，当go runtime启动时候，都会创建一个独立的M，称为sysmon，它既不关联P也不执行G，它是系统级线程。sysmon会检查go runtime中长时间运行的G，并进行抢占。</p>
<p>go1.13版本中，sysmon如果发现某个G运行时间超过10ms就会将该G标记为可抢占状态，此外G在运行过程中有一个函数栈分裂处理的逻辑，该处理逻辑会查看其是否被标记为可抢占状态，如果是那么其会让出其关联的M。</p>
<p>示例代码中for循序不会出现栈分裂的情况，所以G即使运行超过10ms也不会被抢占。由于所有的P关联的G都运行着for死循环，且不会被抢占，那么就没有多余的P可以执行fmt.Println语句了。</p>
<p>由于go1.13是基于函数栈分裂实现的抢占式调度，所以也称为半抢占式调度(即未完全实现抢占式调度）或协作抢占式调度。</p>
<p>go1.14版本为了解决类似示例代码中问题，引入了信号机制实现抢占式调度。sysmon发现某个G运行时间超过10ms，就会给该G发送一个信号（SIGURG），该G收到抢占调度信号后，会让出M。</p>
<h3 id="sysmon">Sysmon 有什么作用?<a class="headerlink" href="#sysmon" title="Permanent link">&para;</a></h3>
<p>Go Runtime 在启动程序的时候，会创建一个独立的 M 作为监控线程，称为 sysmon，它是一个系统级的 daemon 线程。这个sysmon 独立于 GPM 之外，也就是说不需要P就可以运行。sysmon监控线程的功能有：</p>
<ul>
<li>用于网络轮询器中，唤醒准备就绪的fd关联的goroutine</li>
<li>如果超过2分钟没有GC，则强制执行GC一次</li>
<li>抢占运行时间太长Goroutine（超过10ms的g，会进行retake)</li>
<li>handle off长时间运行系统调用的M，即将M和P解绑，P重新找到空闲的M，执行任务，若没有空闲的M，则会创建一个。</li>
<li>定时器与滴答器的调度处理</li>
<li>打印schedule trace信息</li>
</ul>
<h2 id="defer">defer 语法特点有哪些，底层实现机制？<a class="headerlink" href="#defer" title="Permanent link">&para;</a></h2>
<h3 id="_1">概念<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>defer语法是用来定义一个延迟函数，遵循LIFO顺序。defer在运行过程遵循下面三条官方规则：</p>
<ul>
<li>
<p>defer函数的传入参数在定义时就已经明确</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="c1">// 只会打印出来1</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nx">i</span><span class="o">++</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="k">return</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>defer函数是按照后进先出的顺序执行</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">        </span><span class="k">defer</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="c1">// 依次输出54321</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>defer函数可以读取和修改函数的命名返回值</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">test</span><span class="p">())</span><span class="w"> </span><span class="c1">// 输出101</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="p">}</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">test</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">        </span><span class="nx">i</span><span class="o">++</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="p">}()</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="_2">原理<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="https://static.cyub.vip/images/202105/defer_profile.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="https://static.cyub.vip/images/202105/defer_profile.png" src="https://static.cyub.vip/images/202105/defer_profile.png" /></a></p>
<p><strong>简单描述</strong>：</p>
<ul>
<li>底层结构_defer结构体，多个defer函数构成_defer链表，后面的defer函数会插入链表头部，最后该链表挂载到G上面，执行时候从链表头部依次执行</li>
<li>为了减少创建_defer结构体的内存分配，Go采用了两层defer缓冲池，分别为per-P级别，这个是无锁的，goroutine有限从当前P中取。剩下一个是全局的defer缓存。</li>
</ul>
<p><strong>详细描述</strong>：</p>
<p>defer语法对应的底层数据结构是_defer结构体，多个defer函数会构建成一个_defer链表，后面加入的defer函数会插入链表的头部，该链表链表头部会链接到G上。当函数执行完成返回的时候，会从_defer链表头部开始依次执行defer函数。这也就是defer函数执行时会LIFO的原因。</p>
<p>创建_defer结构体是需要进行内存分配的，为了减少分配_defer结构体时资源消耗，Go底层使用了**两级defer缓冲池（defer pool）**，用来缓存上次使用完的_defer结构体，这样下次可以直接使用，不必再重新分配内存了。defer缓冲池一共有两级：per-P级defer缓冲池和全局defer缓冲池。当创建_defer结构体时候，优先从当前M关联的P的缓冲池中取得_defer结构体，即从per-P缓冲池中获取，这个过程是无锁操作。如果per-P缓冲池中没有，则在尝试从全局defer缓冲池获取，若也没有获取到，则重新分配一个新的_defer结构体。</p>
<p><strong>测试题目：</strong></p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="k">defer</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="c1">// 54321</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">test1</span><span class="p">())</span><span class="w"> </span><span class="c1">// 2</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">test2</span><span class="p">())</span><span class="w"> </span><span class="c1">// 1</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">test3</span><span class="p">())</span><span class="w"> </span><span class="c1">// 2</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="p">}</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="c1">// 测试1</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">test1</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">        </span><span class="nx">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="p">}()</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="p">}</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="kd">func</span><span class="w"> </span><span class="nx">test2</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">        </span><span class="nx">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">    </span><span class="p">}()</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="p">}</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="kd">func</span><span class="w"> </span><span class="nx">test3</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="w">        </span><span class="nx">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="w">    </span><span class="p">}(</span><span class="nx">r</span><span class="p">)</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="_3">适用场景<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li>用户资源的释放操作</li>
<li>修改命名返回值</li>
<li>和recover关键字一起用于panic捕获</li>
</ul>
<h2 id="select">select可以用于做什么?<a class="headerlink" href="#select" title="Permanent link">&para;</a></h2>
<p>通道选择器，常用语gorotine的退出。golang 的 select 就是监听 IO 操作，当 IO 操作发生时，触发相应的动作，每个case语句里必须是一个IO操作，确切的说，应该是一个面向channel的IO操作。</p>
<ol>
<li>监听exit通道</li>
<li>or-done模式</li>
</ol>
<h2 id="_4">映射<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="mapmap">map是否是并发安全的，如何实现顺序读取，如何实现并发的map?<a class="headerlink" href="#mapmap" title="Permanent link">&para;</a></h3>
<h3 id="mapkeymap">map中底层设计的知识点，key长度过长会不会影响map的读写效率？<a class="headerlink" href="#mapkeymap" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="https://static.cyub.vip/images/202106/map_access.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="https://static.cyub.vip/images/202106/map_access.png" src="https://static.cyub.vip/images/202106/map_access.png" /></a></p>
<p>访问映射涉及到key定位的问题，首先需要确定从哪个桶找，确定桶之后，还需要确定key-value具体存放在哪个单元里面（每个桶里面有8个坑位）。key定位详细流程如下：</p>
<ol>
<li>首先需根据hash函数计算出key的hash值</li>
<li>该key的hash值的低<code>hmap.B</code>位的值是该key所在的桶</li>
<li>该key的hash值的高8位，用来快速定位其在桶具体位置。一个桶中存放8个key，遍历所有key，找到等于该key的位置，此位置对应的就是值所在位置</li>
<li>根据步骤3取到的值，计算该值的hash，再次比较，若相等则定位成功。否则重复步骤3去<code>bmap.overflow</code>中继续查找。</li>
<li>若<code>bmap.overflow</code>链表都找个遍都没有找到，则返回nil。</li>
</ol>
<p><strong>删除map中元素时候并不会释放内存</strong>。删除时候，会清空映射中相应位置的key和value数据，并将对应的tophash置为emptyOne。此外会检查当前单元旁边单元的状态是否也是空状态，如果也是空状态，那么会将当前单元和旁边空单元状态都改成emptyRest。</p>
<p>Go语言中映射扩容采用渐进式扩容，避免一次性迁移数据过多造成性能问题。当对映射进行新增、更新时候会触发扩容操作然后进行扩容操作（删除操作只会进行扩容操作，不会进行触发扩容操作），每次最多迁移2个bucket。扩容方式有两种类型：</p>
<ol>
<li>等容量扩容</li>
<li>双倍容量扩容</li>
</ol>
<h3 id="syncmap">sync.Map的适合场景，如果是写多读少且支持并发怎么设计？<a class="headerlink" href="#syncmap" title="Permanent link">&para;</a></h3>
<p>sync.Map适用于读多写少的场景。对于写多的场景，会导致 read map 缓存失效，需要加锁，导致冲突变多；而且由于未命中 read map 次数过多，导致 dirty map 提升为 read map，这是一个 O(N) 的操作，会进一步降低性能。</p>
<ul>
<li>sync.Map采用空间换时间策略。其底层结构存在两个map，分别是read map和dirty map。当读取操作时候，优先从read map中读取，是不需要加锁的，若key不存在read map中时候，再从dirty
map中读取，这个过程是加锁的。当新增key操作时候，只会将新增key添加到dirty map中，此操作是加锁的，但不会影响read map的读操作。当更新key操作时候，如果key已存在read map中时候，只需无锁更新更新read map就行，同时负责加锁处理在dirty map中情况了。总之sync.Map会优先从read map中读取、更新、删除，因为对read map的读取不需要锁</li>
<li>当sync.Map读取key操作时候，若从read map中一直未读到，若dirty map中存在read map中不存在的keys时，则会把dirty map升级为read map，这个过程是加锁的。这样下次读取时候只需要考虑从read map读取，且读取过程是无锁的</li>
</ul>
<h3 id="syncmutexmapmap">为什么不使用sync.Mutex+map实现并发的map呢？<a class="headerlink" href="#syncmutexmapmap" title="Permanent link">&para;</a></h3>
<p>这个问题可以换个问法就是sync.Map相比sync.Mutex+map实现并发map有哪些优势？</p>
<p>sync.Map优势在于当key存在read map时候，如果进行Store操作，可以使用原子性操作更新，而sync.Mutex+map形式每次写操作都要加锁，这个成本更高。</p>
<p>另外并发读写两个不同的key时候，写操作需要加锁，而读操作是不需要加锁的。</p>
<h2 id="_5">通道<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="channel">channel有哪几种类型？有哪些特点？底层数据是怎么样的？是否是并发安全的，以及怎么做到并发安全的？<a class="headerlink" href="#channel" title="Permanent link">&para;</a></h3>
<p>channel收发遵循FIFO原则，其底层是hchan结构指针，创建通道使用make关键字。对于有缓存的通道，其底层是固定大小的循环队列。由于对通道读取、写入时候会加锁，所以是并发安全的。当channel因为缓冲区不足而阻塞队列时候，则使用双向链表存储。Go语言中，不要通过共享内存来通信，而要通过通信实现内存共享。Go的CSP(Communicating Sequential Process)并发模型，中文可以叫做通信顺序进程，是通过 goroutine 和 channel 来实现的。</p>
<p><strong>通道类型有：</strong></p>
<ul>
<li>有缓存通道/无缓冲通道</li>
<li>读写通道/只读通道/只写通道</li>
</ul>
<p><strong>特点有：</strong></p>
<ul>
<li>读写nil通道，永远阻塞。关闭nil通道会panic</li>
<li>读一个已关闭的通道，如果缓存区为空时候，则返回一个零值。可以使用for-range或者逗号ok</li>
<li>写一个已关闭的通道，会panic</li>
</ul>
<h3 id="cap">内置的cap函数可以用于哪些内容？<a class="headerlink" href="#cap" title="Permanent link">&para;</a></h3>
<ul>
<li>array</li>
<li>slice</li>
<li>channel</li>
</ul>
<h3 id="channel-close">为啥 channel 会有 close 这个操作, 在哪些场景下会用到这个操作 ?<a class="headerlink" href="#channel-close" title="Permanent link">&para;</a></h3>
<p>在 Go 语言中，channel 的 close 操作用于向 channel 的接收方明确地通知发送操作已经完成。关闭一个 channel 可以表达“没有更多的数据将被发送到这个 channel”这一信号。这是一种控制信号，帮助接收方理解数据流的生命周期，并且可以避免在 channel 上进行无限等待。</p>
<h4 id="close">使用 close 的场景<a class="headerlink" href="#close" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>通知多个接收者完成处理</strong>：</p>
<p>当使用一个 channel 来分发任务或数据给多个协程（goroutines）时，关闭 channel 是一种告知所有接收者没有更多数据要处理的有效方法。接收者可以通过检测 channel 是否已关闭来适时停止处理。</p>
</li>
<li>
<p><strong>控制循环退出</strong>：</p>
<p>在接收数据时，可以使用 for range 循环从 channel 接收数据。当 channel 被关闭，并且 channel 中已经没有待处理的数据时，for range 循环会自动结束。这使得编码简洁，并且逻辑清晰。</p>
</li>
<li>
<p><strong>防止资源泄露</strong>：</p>
<p>如果不关闭不再使用的 channel，可能会导致内存资源没有得到释放，特别是在 channel 还保持着一些数据项的情况下。尽管 Go 的垃圾回收机制会回收未引用的对象，但显式关闭 channel 是一个好的实践，它可以清晰地表达程序设计者的意图。</p>
</li>
<li>
<p><strong>使用 select 的默认操作</strong>：</p>
<p>在使用 select 语句处理多个 channel 的时候，关闭一个 channel 可以用于触发其他 case 的执行。特别是在一些需要优雅退出的并发模式中，关闭 channel 可以促使 select 快速响应并处理结束逻辑。</p>
</li>
</ol>
<h4 id="_6">示例：数据处理和广播信号<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>假设有一个数据处理任务，需要将数据分批发送到多个处理协程，处理完成后再汇总结果。这里可以使用关闭 channel 的方式来告知所有处理协程，数据已经发送完毕：</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">processData</span><span class="p">(</span><span class="nx">dataChunks</span><span class="w"> </span><span class="p">[][]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nx">resultChan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nx">dataChan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="c1">// 启动多个工作协程</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">dataChan</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">                </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="c1">// 假设有一个处理函数</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">                </span><span class="nx">resultChan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">        </span><span class="p">}()</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">    </span><span class="c1">// 发送数据</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">chunk</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">dataChunks</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">chunk</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">                </span><span class="nx">dataChan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">data</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">        </span><span class="nb">close</span><span class="p">(</span><span class="nx">dataChan</span><span class="p">)</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">    </span><span class="p">}()</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">    </span><span class="c1">// 接收结果</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">dataChunks</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">resultChan</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">            </span><span class="nx">results</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">        </span><span class="nb">close</span><span class="p">(</span><span class="nx">resultChan</span><span class="p">)</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">    </span><span class="p">}()</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">results</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="p">}</span>
</span></code></pre></div>
<p>在这个示例中，通过关闭 dataChan 来告知工作协程不会再有新的数据发送，这时协程可以结束从 channel 接收数据的操作。关闭 resultChan 则用来表示所有结果已经处理完毕，可以进行后续步骤。</p>
<p>总结来说，关闭一个 channel 是一种向接收方传递完成信号的方法，它在多协程协作的环境中尤为有用，有助于提高代码的可读性和安全性。</p>
<h2 id="go_2">Go如何避免内存的对象频繁分配和回收的问题？<a class="headerlink" href="#go_2" title="Permanent link">&para;</a></h2>
<p>可以考虑使用对象缓存池sync.Pool</p>
<h2 id="go_3">Go如何进行并发竞态检测，如何避免竞态问题？<a class="headerlink" href="#go_3" title="Permanent link">&para;</a></h2>
<p>Go支持go run/test/build 使用-race选项进行竞态检查。可以使用锁、信号量等同步手段保护临界区，或者原子操作等手段避免竞态问题。</p>
<h2 id="_7">如何实现循环队列？<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>channel或者atomic实现。</p>
<h2 id="_8">锁<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="_9">锁种类<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<ul>
<li>写锁-sync.Mutex，属于排他锁（或互斥锁）</li>
<li>读写锁-sync.RWMutex，属于共享锁</li>
</ul>
<p>这两种锁的对象单元都是goroutine，底层用到类似信号机制。在runtime时也有mutex锁，底层使用futex系统调用，锁的对象是线程M，它还会阻止相关联的 G 和 P 被重新调度。</p>
<p>所有锁使用时候需要指针传递，也就是nocopy机制。此外Go内置的锁也不是可重入的。</p>
<h3 id="syncmutex">sync.Mutex的工作模式<a class="headerlink" href="#syncmutex" title="Permanent link">&para;</a></h3>
<p>Mutex 一共有下面几种状态：</p>
<ul>
<li>mutexLocked — 表示互斥锁的锁定状态；</li>
<li>mutexWoken — 表示从正常模式被从唤醒；</li>
<li>mutexStarving — 当前的互斥锁进入饥饿状态；</li>
<li>waitersCount — 当前互斥锁上等待的 Goroutine 个数；</li>
</ul>
<p>正常模式和饥饿模式：</p>
<p>对于两种模式，正常模式下的性能是最好的，goroutine 可以连续多次获取锁，饥饿模式解决了取锁公平的问题，但是性能会下降，这其实是性能和公平的一个平衡模式。</p>
<ul>
<li>
<p>正常模式（非公平锁）</p>
<p>正常模式下，所有等待锁的 goroutine 按照 FIFO（先进先出）顺序等待。唤醒的 goroutine 不会直接拥有锁，而是会和新请求 goroutine 竞争锁。新请求的goroutine 更容易抢占：因为它正在 CPU 上执行，所以刚刚唤醒的 goroutine有很大可能在锁竞争中失败。在这种情况下，这个被唤醒的 goroutine 会加入到等待队列的前面。</p>
</li>
<li>
<p>饥饿模式（公平锁）</p>
<p>为了解决了等待 goroutine 队列的长尾问题。饥饿模式下，直接由 unlock 把锁交给等待队列中排在第一位的 goroutine (队头)，同时，饥饿模式下，新进来的 goroutine 不会参与抢锁也不会进入自旋状态，会直接进入等待队列的尾部。这样很好的解决了老的 goroutine 一直抢不到锁的场景。</p>
</li>
</ul>
<p>饥饿模式的触发条件：当一个 goroutine 等待锁时间超过 1 毫秒时，或者当前队列只剩下一个 goroutine 的时候，Mutex 切换到饥饿模式。</p>
<p>Mutex运行自旋的条件有：</p>
<ul>
<li>锁已被占用，并且锁不处于饥饿模式。</li>
<li>积累的自旋次数小于最大自旋次数（active_spin=4）。</li>
<li>CPU 核数大于 1。有空闲的 P。</li>
<li>当前 Goroutine 所挂载的 P 下，本地待运行队列为空。</li>
</ul>
<h3 id="rwmutex">RWMutex实现原理？以及在使用过程中需要注意事项？<a class="headerlink" href="#rwmutex" title="Permanent link">&para;</a></h3>
<p>RWMutex是读写锁，用于解决读者-写者问题，并且是写者优先的锁。如果有写者提出申请资源，在申请之前已经开始读取操作的可以继续执行读取，但是如果再有读者申请读取操作，则不能够读取，只有在所有的写者写完之后才可以读取。写者优先解决了读者优先造成写饥饿的问题</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">RWMutex</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="nx">w</span><span class="w">           </span><span class="nx">Mutex</span><span class="w">  </span><span class="c1">// 互斥锁</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="nx">writerSem</span><span class="w">   </span><span class="kt">uint32</span><span class="w"> </span><span class="c1">// writers信号量</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="nx">readerSem</span><span class="w">   </span><span class="kt">uint32</span><span class="w"> </span><span class="c1">// readers信号量</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="nx">readerCount</span><span class="w"> </span><span class="kt">int32</span><span class="w">  </span><span class="c1">// reader数量</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nx">readerWait</span><span class="w">  </span><span class="kt">int32</span><span class="w">  </span><span class="c1">// writer申请锁时候，已经申请到锁的reader的数量</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>对于读者优先（readers-preference）的读写锁，只需要一个**readerCount**记录所有读者，就可以轻易实现。<strong>Go中的RWMutex实现的是写者优先（writers-preference）的读写锁</strong>，那就需要用到**readerWait**来记录写者申请锁时候，已经获取到锁的读者数量。</p>
<p>这样当后续有其他读者继续申请锁时候，可以读取readerWait是否大于0，大于0则说明有写者已经申请锁了，按照写者优先（writers-preference）原则，该读者需要排到写者之后，但是我们还需要记录这些排在写者后面读者的数量呀，毕竟写着将来释放锁的时候，还得一个个唤醒这些读者。这种情况下既要读取readerWait，又要更新排队的读者数量readerCount，这是两个操作，无法原子化。RWMutex在实现时候，通过将readerCount转换成负数，一方面表明有写者申请了锁，另一方面readerCount还可以继续记录排队的读者数量，解决刚描述的无法原子化的问题，真是巧妙！</p>
<p>错误的使用场景：</p>
<ul>
<li>RLock/RUnlock、Lock/Unlock未成对出现</li>
<li>复制sync.RWMutex作为函数值传递</li>
<li>不可重入导致死锁</li>
</ul>
<h2 id="syncwaitgroup">sync.WaitGroup用法以及实现原理？<a class="headerlink" href="#syncwaitgroup" title="Permanent link">&para;</a></h2>
<p>sync.WaitGroup用于等待一组协程完成。</p>
<p>sync.WaitGroup维护了2个计数器，一个是请求计数器，每次执行Add时候，该计数器会加1，另外一个是等待计数器，每次执行Wait时候，该计数器会加1。当执行Done时候，会将请求计数器减一，当请求计数器为0时候，会唤醒等待的等待者。</p>
<p>需要注意的时候Add()和Wait() 不能并发调用。</p>
<h2 id="synconce">sync.Once用法<a class="headerlink" href="#synconce" title="Permanent link">&para;</a></h2>
<p>sync.Once用来执行且执行一次动作，常常用于单例对象初始化场景。</p>
<h2 id="cas">什么是CAS?<a class="headerlink" href="#cas" title="Permanent link">&para;</a></h2>
<p>CAS全称为Compare And Swap，中文翻译为比较交换，是一条原子指令，对应cmpxchg指令，其原理是先比较两个值是否相等，然后原子地更新某个位置的值。基于CAS我们可以实现一个自旋锁，无锁堆栈。基于CAS实现的无锁数据结构中，需要注意<a href="https://github.com/cyub/code-examples/tree/master/go/concurrent-programming#lock-free-stack">ABA问题</a>。</p>
<h2 id="syncpool">sync.Pool的用法以及实现原理？<a class="headerlink" href="#syncpool" title="Permanent link">&para;</a></h2>
<p>频繁地分配，回收内存会给GC带来一定负担，严重时候，会引起CPU的毛刺现象，而通过sync.Pool可以将暂时不用的对象缓存起来，等下次需要时候直接使用，不用再次经过内存分配，复用对象的内存，减轻GC的压力，提升系统的性能。</p>
<p>sync.Pool提供了临时对象缓存池，存在池子的对象可能在任何时刻被自动移除，我们对此不能做任何预期。sync.Pool可以并发使用，它通过复用对象来减少对象内存分配和GC的压力。当负载大的时候，临时对象缓存池会扩大，缓存池中的对象会在每2个GC循环中清除。</p>
<p>sync.Pool拥有两个对象存储容器：local pool和victim cache。local pool与victim cache相似，相当于primary cache。当获取对象时，优先从local pool中查找，若未找到则再从victim cache中查找，若也未获取到，则调用New方法创建一个对象返回。当对象放回sync.Pool时候，会放在local pool中。当GC开始时候，首先将victim cache中所有对象清除，然后将local pool容器中所有对象都会移动到victim cache中，所以说缓存池中的对象会在每2个GC循环中清除。</p>
<p>若G关联的per-P级poolLocal的双端队列中没有取出来对象，那么就尝试从其他P关联的poolLocal中偷一个。若从其他P关联的poolLocal没有偷到一个，那么就尝试从victim cache中取。</p>
<p>若步骤4中也没没有取到缓存对象，那么只能调用pool.New方法新创建一个对象。</p>
<h2 id="_10">如何避免死锁？<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>死锁检测，活锁，银行家算法</p>
<h2 id="go_4">Go中内存逃逸是怎么回事？怎么检测内存逃逸？有哪些内存逃逸的场景？<a class="headerlink" href="#go_4" title="Permanent link">&para;</a></h2>
<p>Go 语言中决定一个变量分配栈上还是堆是Go编译器决定的，如果变量分配到堆上那么我们就说着变量发生了逃逸。我们设置-gcflags=”-m”来检测内存逃逸。内存逃逸的场景一般有：</p>
<ol>
<li>函数返回局部变量的指针(一般会，并不绝对）</li>
<li>闭包中捕获变量会发生更改时候</li>
<li>切片变量过大时候</li>
</ol>
<h2 id="set">实现一个并发安全的set？<a class="headerlink" href="#set" title="Permanent link">&para;</a></h2>
<div class="language-go highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">inter</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Set</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nx">m</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">inter</span><span class="p">]</span><span class="kt">bool</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="p">}</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="kd">func</span><span class="w"> </span><span class="nx">New</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Set</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Set</span><span class="p">{</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nx">m</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">inter</span><span class="p">]</span><span class="kt">bool</span><span class="p">{},</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="p">}</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="p">}</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Set</span><span class="p">)</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="nx">inter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="nx">s</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="k">defer</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="nx">s</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="_11">主协程如何等其余协程完再操作?<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<p>sync.Waitgroup</p>
<h2 id="struct">struct结构能不能比较？<a class="headerlink" href="#struct" title="Permanent link">&para;</a></h2>
<p>这个设计到Go语言中<a href="https://go.dev/ref/spec#Comparison_operators">可比较性规则</a>。</p>
<ul>
<li>切片、映射、函数不可比较，但都可以和nil比较</li>
<li>当通道元素类型一样时候，可以比较，即使缓冲大小不一样</li>
<li>指针类型只有指向的变量的类型一样时候，才能够比较。但都可以和nil比较</li>
<li>接口类型都可以相互比较，只有底层类型和底层值一样时候，才会相等</li>
<li>数组类型，只有元素类型和数组大小一样时候，才可以进行比较</li>
<li>
<p>如果结构体中所有字段都是可以比较的，那么该结构体就是可以比较的。注意：字段比较时候需要按照相同顺序依次比较。</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">        </span><span class="nx">A</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="nx">B</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="p">}{}</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="nx">B</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">        </span><span class="nx">A</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="p">}{}</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">t3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">        </span><span class="nx">A</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">        </span><span class="nx">B</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">        </span><span class="nx">c</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="c1">// unexport</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span><span class="p">}{}</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">t1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">t2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 不能比较</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">t1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">t3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 不能比较</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="c1">// invalid operation: t1 == t2 (mismatched types struct{A string; B string} and struct{B string; A string})</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="c1">// invalid operation: t1 == t3 (mismatched types struct{A string; B string} and struct{A string; B string; c int})</span>
</span></code></pre></div>
</li>
</ul>
<h2 id="go_5">Go里面的值传递和指针传递？<a class="headerlink" href="#go_5" title="Permanent link">&para;</a></h2>
<p>函数参数传递方式一般有两种:值传递和引用传递。其中值传递中可以传递指针，这种情况可以称为指针传递。指针传递不等于引用传递，尽管两者都可以改变原始值。</p>
<p>Go语言中所有都是值传递。切片，通道，映射属于指针传递，因为它们底层是一个指针(或者是胖指针)</p>
<h2 id="context">context包的用途？<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<p>context.Context的作用就是在不同的goroutine之间同步请求特定数据、取消信号以及处理请求的截止日期。</p>
<h2 id="_12">字符串有哪几种拼接方式？性能怎么样？<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<p>字符串底层结构本质是一个fat-pointer:</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">StringHeader</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="nx">Data</span><span class="w"> </span><span class="kt">uintptr</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="nx">Len</span><span class="w">  </span><span class="kt">int</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>+号拼接，会产生临时字符串，性能一般</li>
<li>fmt.Printf 进行拼接，由于字符串会变成interface{}，产生内存逃逸，性能较差</li>
<li>strings.Join 用于字符串切片拼接，底层用到了strings.Builder，性能比较高</li>
<li>strings.Builder 性能高，底层用到内存缓冲，内存缓冲结构是字节切片，输出字符串时候使用了zero-copy技术直接把字节切片转换成字符串。缺点就是每次reset时候都会将内存缓冲至为nil，不能够复用</li>
<li>bytes.Buffer 性能高，跟strings.Builder类似，但reset时候不会将内存缓冲至为nil，能够达到复用的目的</li>
</ul>
<h2 id="go-c">Go 数组与C语言数组有什么区别？<a class="headerlink" href="#go-c" title="Permanent link">&para;</a></h2>
<p>Go语言中数组是一片连续的内存，是**一个值类型**，作为参数传递时候会把COPY旧数组形成一个新数组作为函数的参数。这也意味着在函数内改变数组值，不会影响原数组。</p>
<h2 id="slicelencap">slice的len,cap知识，底层共享等问题，以及扩容策略？<a class="headerlink" href="#slicelencap" title="Permanent link">&para;</a></h2>
<h3 id="_13">切片概念<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>Go中切片是动态数组的概念，底层结构类似字符串，但其指针指向的内存是可以更改的，并且它还有一个容量字段。</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="nx">array</span><span class="w"> </span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="w"> </span><span class="c1">// 底层数据数组的指针</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="nx">len</span><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="c1">// 切片长度</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="nx">cap</span><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="c1">// 切片容量</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>切片作为参数传递时候也是值传递，但它传递的是指针，属于指针传递，所以它拥有引用传递的特性</strong>。</p>
<p>为了避免切片指针传递带来的副作用，可以使用内置copy函数复制一个全新的切片再传递。</p>
<h3 id="_14">创建方式<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>切片的创建方式有：</p>
<ol>
<li>使用make关键字创建，形式make([]T, length, capacity)，capacity可以省略，默认等于length</li>
<li>
<p>基于数组，指向数组的指针，切片构建一个切片</p>
<p>reslice操作语法可以是[]T[low : high]，也可以是[]T[low : high : 
max]。其中low,high,max都可以省略，low默认值是0，high默认值cap([]T)，max默认值cap([]T)。low,hight,max取值范围是<code>0 &lt;= low &lt;= high &lt;= max &lt;= cap([]T)</code>
，其中high-low是新切片的长度，max-low是新切片的容量。</p>
<p>对于[]T[low : high]，其包含的元素是[]T中下标low开始，到high结束（不含high所在位置的，相当于左闭右开[low, high)）的元素，元素个数是high - low个，容量是cap([]T) - low。</p>
</li>
<li>
<p>使用字面量创建</p>
</li>
</ol>
<h3 id="reslice">reslice<a class="headerlink" href="#reslice" title="Permanent link">&para;</a></h3>
<p>基于切片或者数组reslice一个新切片时候，需要注意新切片的容量：</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="nx">slice1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nx">slice2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="nx">slice3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="nx">slice4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="nx">slice5</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="nx">slice6</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="nx">slice7</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="nx">slice8</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="nx">slice9</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span><span class="nx">slice10</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">slice2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice1</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice1</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice1</span><span class="p">))</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice2</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice2</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice2</span><span class="p">))</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice3&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice3</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice3</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice3</span><span class="p">))</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice4&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice4</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice4</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice4</span><span class="p">))</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice5&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice5</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice5</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice5</span><span class="p">))</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice6&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice6</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice6</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice6</span><span class="p">))</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice7&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice7</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice7</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice7</span><span class="p">))</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice8&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice8</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice8</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice8</span><span class="p">))</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice9&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice9</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice9</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice9</span><span class="p">))</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s = %v,\t len = %d, cap = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slice10&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice10</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">slice10</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">slice10</span><span class="p">))</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="p">}</span>
</span></code></pre></div>
<p>上面输出：</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nx">slice1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[],</span><span class="w">     </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nx">slice2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w">    </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nx">slice3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[],</span><span class="w">     </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="nx">slice4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w">    </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="nx">slice5</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w">    </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="nx">slice6</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w">    </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="nx">slice7</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w">  </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="nx">slice8</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w">    </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="nx">slice9</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[],</span><span class="w">     </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="nx">slice10</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w">   </span><span class="nx">len</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span>
</span></code></pre></div>
<h3 id="_15">扩容策略<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>切片的扩容策略是：</p>
<ol>
<li>首先判断，如果新申请容量大于 2 倍的旧容量，最终容量就是新申请的容量</li>
<li>否则判断，如果旧切片的长度小于 1024，则最终容量就是旧容量的两倍</li>
<li>否则判断，如果旧切片长度大于等于 1024，则最终容量从旧容量开始循环增加原来的 &frac14;, 直到最终容量大于等于新申请的容量。由于考虑内存对齐，最终实际扩容大小可能会大于&frac14;</li>
</ol>
<h3 id="_16">常见用法<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<div class="language-go highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">//copy</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nx">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nb">copy</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1">//cut</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">a</span><span class="p">[:</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="c1">//delte</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">a</span><span class="p">[:</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="c1">// or</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="p">[:</span><span class="nx">i</span><span class="o">+</span><span class="nb">copy</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">:],</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="c1">// insert</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="nb">copy</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span><span class="w"> </span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">:])</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">x</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="c1">//pop</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="nx">a</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="c1">//push</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="c1">//shift</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="c1">//unshift</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">([]</span><span class="nx">T</span><span class="p">{</span><span class="nx">x</span><span class="p">},</span><span class="w"> </span><span class="nx">a</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="c1">//反转</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="k">for</span><span class="w"> </span><span class="nx">left</span><span class="p">,</span><span class="w"> </span><span class="nx">right</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">left</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">right</span><span class="p">;</span><span class="w"> </span><span class="nx">left</span><span class="p">,</span><span class="w"> </span><span class="nx">right</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">left</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">right</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="w">    </span><span class="nx">a</span><span class="p">[</span><span class="nx">left</span><span class="p">],</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">right</span><span class="p">],</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="zero-copy">字符串与切片内存zero-copy转换的实现？<a class="headerlink" href="#zero-copy" title="Permanent link">&para;</a></h3>
<div class="language-go highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">bytes2string</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="kt">string</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">b</span><span class="p">))</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="p">}</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">StringToBytes</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="nx">sh</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">StringHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s</span><span class="p">))</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="nx">bh</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">b</span><span class="p">))</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="nx">bh</span><span class="p">.</span><span class="nx">Data</span><span class="p">,</span><span class="w"> </span><span class="nx">bh</span><span class="p">.</span><span class="nx">Len</span><span class="p">,</span><span class="w"> </span><span class="nx">bh</span><span class="p">.</span><span class="nx">Cap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sh</span><span class="p">.</span><span class="nx">Data</span><span class="p">,</span><span class="w"> </span><span class="nx">sh</span><span class="p">.</span><span class="nx">Len</span><span class="p">,</span><span class="w"> </span><span class="nx">sh</span><span class="p">.</span><span class="nx">Len</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="p">}</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">StringToBytes</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">[]</span><span class="kt">byte</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">        </span><span class="o">&amp;</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">            </span><span class="kt">string</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">            </span><span class="nx">Cap</span><span class="w"> </span><span class="kt">int</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">        </span><span class="p">}{</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)},</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">    </span><span class="p">))</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="makenew">make与new的区别？<a class="headerlink" href="#makenew" title="Permanent link">&para;</a></h2>
<ul>
<li>Go 中make关键字用来创建切片，通道，映射，返回是引用类型本身，new返回的是指向类型的指针。new返回的类型指针指向的值为该类型的零值。由于new不会初始化内存，只是清零内存，所以new切片，通道，映射之后，并不能直接使用：</li>
</ul>
<div class="language-go highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">}</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="nx">puser</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">User</span><span class="p">)</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="nx">puser</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">puser</span><span class="p">)</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="nx">pint</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">    </span><span class="o">*</span><span class="nx">pint</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">123</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">pint</span><span class="p">)</span><span class="w"> </span><span class="c1">// 123</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">    </span><span class="nx">parr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">([</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="nx">parr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">123</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">parr</span><span class="p">)</span><span class="w"> </span><span class="c1">// &amp;[0 123 0 0 0]</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">    </span><span class="nx">pslice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">([]</span><span class="kt">int</span><span class="p">)</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="nx">pslice</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="c1">// /panic: runtime error: index out of range</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">    </span><span class="nx">pmap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="nx">pmap</span><span class="p">)[</span><span class="s">&quot;a&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="c1">// panic: assignment to entry in nil map</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w">    </span><span class="nx">pchan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="w">    </span><span class="nx">pchan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;good&quot;</span><span class="w"> </span><span class="c1">//invalid operation: cv &lt;- &quot;good&quot; (send to non-chan type *chan string)</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="nil">nil 的概念<a class="headerlink" href="#nil" title="Permanent link">&para;</a></h2>
<p>对应于引用类型的变量，它的零值是nil。零值指的是当声明变量且未显示初始化时，Go语言会自动给变量赋予一个默认初始值。</p>
<ul>
<li>对nil通道读写操作会永远阻塞</li>
<li>对nil切片，可以append操作，读写会panic</li>
<li>对nil映射读取和删除ok，写入会panic</li>
<li>nil可以作为接收者，只不是值为nil而已</li>
</ul>
<h3 id="go_6">Go语言中指针与非安全指针类型概念？<a class="headerlink" href="#go_6" title="Permanent link">&para;</a></h3>
<p><strong>对于任意类型T，其对应的的指针类型是*T，类型T称为指针类型*T的基类型。</strong>
一个指针类型*T变量B存储的是类型T变量A的内存地址，我们称该指针类型变量B**引用(reference)了A。从指针类型变量B获取（或者称为访问）A变量的值的过程，叫解引用**
。解引用是通过解引用操作符*操作的。</p>
<p>Go中unsafe.Pointer是非安全类型指针，它作为桥梁，用于任意类型指针与uintptr互换。</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">MyInt</span><span class="w"> </span><span class="kt">int</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%p\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">a</span><span class="p">)</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%x\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">uintptr</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">)))</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="_17">三色标记法原理<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h2>
<p>Golang中采用 <strong>三色标记清除算法（tricolor mark-and-sweep algorithm）</strong> 进行GC。由于支持写屏障（write barrier)了，GC过程和程序可以并发运行。</p>
<p>三色标记清除算核心原则就是根据每个对象的颜色，分到不同的颜色集合中，对象的颜色是在标记阶段完成的。三色是黑白灰三种颜色，每种颜色的集合都有特别的含义：</p>
<ul>
<li>
<p>黑色集合</p>
<p>该集合下的对象没有引用任何白色对象（即该对象没有指针指向白色对象）</p>
</li>
<li>
<p>白色集合</p>
<p>扫描标记结束之后，白色集合里面的对象就是要进行垃圾回收的，该对象允许有指针指向黑色对象。</p>
</li>
<li>
<p>灰色集合</p>
<p>可能有指针指向白色对象。它是一个中间状态，只有该集合下不在存在任何对象时候，才能进行最终的清除操作。</p>
</li>
</ul>
<h3 id="gc">GC流程<a class="headerlink" href="#gc" title="Permanent link">&para;</a></h3>
<p>当垃圾回收开始，全部对象标记为白色。</p>
<ul>
<li>垃圾回收器会遍历所有根对象并把它们标记为灰色，放入灰色集合里面。**根对象**就是程序能直接访问到的对象，包括全局变量以及栈、寄存器上的里面的变量。</li>
<li>遍历灰色集合中的对象，把灰色对象引用的白色集合的对象放入到灰色集合中，同时把遍历过的灰色集合中的对象放到黑色的集合中</li>
<li>重复步骤2，直到灰色集合没有对象</li>
<li>步骤3结束之后，白色集合中的对象就是不可达对象，也就是垃圾，可以进行回收</li>
</ul>
<p>为了支持能够并发进行垃圾回收，Golang在垃圾回收过程中采用写屏障，每次堆中的指针被修改时候写屏障都会执行，写屏障会将该指针指向的对象标记为灰色，然后放入灰色集合（因为才对象现在是可触达的了），然后继续扫描该对象。</p>
<p>举个例子说明写屏障的重要性：</p>
<p>假定标记完成的瞬间，A对象是黑色，B是白色，然后A的对象指针字段f由空指针改成指向B，若没有写屏障的话，清除阶段B就会被清除掉，那边A的f字段就变成了悬浮指针，这是有问题的。若存在写屏障那么f字段改变的时候，f指向的B就会放入到灰色集合中，然后继续扫描，B最终也会变成黑色的，那么清除阶段它也就不会被清除了。</p>
<p>除了三色标记法外还有标记清除法，标记清除法的最大弊端就是在整个GC期间需要STW。</p>
<p>虽然 golang 是先实现的插入写屏障，后实现的混合写屏障，但是从理解上，应该是先理解删除写屏障，后理解混合写屏障会更容易理解；</p>
<p>插入写屏障没有完全保证完整的强三色不变式(栈对象的影响)，所以赋值器是灰色赋值器，最后必须 STW 重新扫描栈；</p>
<p>混合写屏障消除了所有的 STW，实现的是黑色赋值器，不用 STW 扫描栈；</p>
<p>混合写屏障的精度和删除写屏障的一致，比以前插入写屏障要低；</p>
<p>混合写屏障扫描栈式逐个暂停，逐个扫描的，对于单个 goroutine 来说，栈要么全灰，要么全黑；</p>
<p>暂停机制通过复用 goroutine 抢占调度机制来实现；</p>
<p><a href="https://www.cnblogs.com/cxy2020/p/16321884.html"><strong>详细总结： Golang GC、三色标记、混合写屏障机制</strong></a></p>
<p><a href="https://blog.csdn.net/weixin_41479678/article/details/124845607"><strong>golang GC工作过程</strong></a></p>
<p><a href="https://blog.csdn.net/weixin_39676242/article/details/111581951">写屏障是什么_Golang 混合写屏障原理深入剖析，这篇文章给你梳理的明明白白！</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/359582221"><strong>两万字长文带你深入Go语言GC源码</strong></a></p>
<p>强三色不变式规则：<strong>不允许黑色对象引用白色对象</strong></p>
<p>破坏了条件一： 白色对象被黑色对象引用</p>
<p>解释：如果一个黑色对象不直接引用白色对象，那么就不会出现白色对象扫描不到，从而被当做垃圾回收掉的尴尬。</p>
<p>弱三色不变式规则：<strong>黑色对象可以引用白色对象，但是白色对象的上游必须存在灰色对象</strong></p>
<p>破坏了条件二：灰色对象与白色对象之间的可达关系遭到破坏</p>
<p>解释： 如果一个白色对象的上游有灰色对象，则这个白色对象一定可以扫描到，从而不被回收</p>
<p>混合写屏障的具体核心规则如下：</p>
<ol>
<li>
<p>GC开始后先将栈上的**可达对象**全部扫描并标记为黑色(之后不再进行第二次重复扫描，无需STW)</p>
</li>
<li>
<p>GC期间，任何在栈上创建的新对象，均为黑色。</p>
</li>
<li>
<p>(堆上)被删除的对象标记为灰色。</p>
</li>
</ol>
<p>4.（堆上)被添加的对象标记为灰色。</p>
<p>场景一：栈对象A的下游引用一个堆对象C，接着该堆对象C被引用它的堆对象B删除。</p>
<ul>
<li>栈A引用（即指向)对象C，由于没有写屏障，C对象不会做任何更改</li>
<li>堆对象B删除掉引用C，由于堆上删除写屏障的存在，那么C如果是灰色和白色的，那C就会标记成灰色</li>
</ul>
<h3 id="gc_1">GC触发时机<a class="headerlink" href="#gc_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>主动触发</p>
<p>调用runtime.GC</p>
</li>
<li>
<p>内存分配至时候被动触发</p>
<p>由mallocgc()发起的，触发条件是堆大小达到或者超过了临界值。使用步调（Pacing）算法，其核心思想是控制内存增长的比例。如 Go 的 GC是一种比例 GC, 下一次 GC 结束时的堆大小和上一次 GC 存活堆大小成比例.</p>
</li>
<li>
<p>基于时间的周期性触发</p>
<p>由系统监控sysmon发起，该触发条件由 runtime.forcegcperiod 变量控制，默认为 2 分钟。当超过两分钟没有产生任何 GC 时，强制触发 GC。</p>
</li>
</ol>
<h3 id="gc_2">辅助GC的目的是？<a class="headerlink" href="#gc_2" title="Permanent link">&para;</a></h3>
<p>辅助GC是mallocgc()函数的一部分，mallocgc()函数式堆分配的关键函数，runtime中new系列函数和make系列函数都依赖它。mallocgc()只有在GC标记阶段才执行辅助GC，并且每个goroutine都已辅助GC的字节额度，超过就不行辅助GC了。辅助GC机制能够优有限避免程序过快地分配内存，从而造成GC工作线程(gc worker)来不及标记的问题。</p>
<h3 id="gc_3">GC如何调优<a class="headerlink" href="#gc_3" title="Permanent link">&para;</a></h3>
<p>通过 go tool pprof 和 go tool trace 等工具</p>
<ul>
<li>控制内存分配的速度，限制 Goroutine 的数量，从而提高赋值器对 CPU</li>
</ul>
<p>的利用率。</p>
<ul>
<li>减少并复用内存，例如使用 sync.Pool 来复用需要频繁创建临时对象，例</li>
</ul>
<p>如提前分配足够的内存来降低多余的拷贝。</p>
<ul>
<li>需要时，增大 GOGC 的值，降低 GC 的运行频率。</li>
<li>对于预分配的大量内存，则可能需要将 debug.SetGCPercent() 设置为低得多的百分比才能获得正常的 GC 频率。</li>
</ul>
<h2 id="reflect">reflect反射三定律？<a class="headerlink" href="#reflect" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Reflection goes from interface value to reflection object</p>
<p>反射可以将“接口类型变量”转换为“反射类型对象”</p>
</li>
<li>
<p>Reflection goes from reflection object to interface value</p>
<p>反射可以将“反射类型对象”转换为“接口类型变量”</p>
</li>
<li>
<p>To modify a reflection object, the value must be settable</p>
<p>如果要修改“反射类型对象”，其值必须是“可写的”（settable）</p>
</li>
</ol>
<h2 id="go-pprof">Go pprof<a class="headerlink" href="#go-pprof" title="Permanent link">&para;</a></h2>
<p>pprof支持以下几种分析器：</p>
<ul>
<li>
<p><strong>Go 分析器</strong></p>
<p>CPU 分析器通过操作系统监控应用程序的CPU 使用情况，并且每隔10ms的CPU 片时间发送一个SIGPROF信号来捕获profile数据。操作系统还包括内核在此监控中代表应用程序消耗的时间。由于信号传输速率取决于 CPU 消耗，因此它是动态的，最高可达 N * ``100Hz，其中 N是操作系统上逻辑 CPU 内核的数量。当 SIGPROF信号到达时，Go 的信号处理程序捕获当前活动的 goroutine 的堆栈跟踪，并增加profile文件中的相应值。 cpu/nanoseconds值目前是直接从samples/count样本计数中推导出来的，所以是多余的，但是使用方便。</p>
</li>
<li>
<p><strong>内存分析器</strong></p>
</li>
<li>
<p><strong>阻塞分析器</strong></p>
<p>Go 中的阻塞分析器衡量你的 goroutine 在等待通道以及<a href="https://pkg.go.dev/sync">sync包</a>提供的互斥操作时在 Off-CPU 外花费的时间。以下 Go 操作会被阻塞分析器捕获分析：</p>
<ul>
<li>select</li>
<li>chan send</li>
<li>chan receive</li>
<li>semacquire ( <a href="https://golang.org/pkg/sync/#Mutex.Lock"><code>Mutex.Lock</code></a>, <a href="https://golang.org/pkg/sync/#RWMutex.RLock"><code>RWMutex.RLock</code></a> , <a href="https://golang.org/pkg/sync/#RWMutex.Lock"><code>RWMutex.Lock</code></a>, <a href="https://golang.org/pkg/sync/#WaitGroup.Wait"><code>WaitGroup.Wait</code></a>)</li>
<li>notifyListWait ( <a href="https://golang.org/pkg/sync/#Cond.Wait"><code>Cond.Wait</code></a>)</li>
</ul>
<p>阻塞 profile文件不包括等待 I/O、睡眠、GC 和各种其他等待状态的时间。此外，阻塞事件在完成之前不会被记录，因此阻塞profile文件不能用于调试 Go 程序当前挂起的原因。后者可以使用 Goroutine 分析器确定。</p>
</li>
</ul>
<h2 id="go_7">Go内存分配原理？<a class="headerlink" href="#go_7" title="Permanent link">&para;</a></h2>
<p>Golang内存分配管理策略是**按照不同大小的对象和不同的内存层级来分配管理内存**。通过这种多层级分配策略，形成无锁化或者降低锁的粒度，以及尽量减少内存碎片，来提高内存分配效率。</p>
<p>Golang中内存分配管理的对象按照大小可以分为：</p>
<table>
<thead>
<tr>
<th>类别</th>
<th>大小</th>
</tr>
</thead>
<tbody>
<tr>
<td>微对象 tiny object</td>
<td>(0, 16B)</td>
</tr>
<tr>
<td>小对象 small object</td>
<td>[16B, 32KB]</td>
</tr>
<tr>
<td>大对象 large object</td>
<td>(32KB, +∞)</td>
</tr>
</tbody>
</table>
<p>Golang中内存管理的层级从最下到最上可以分为：mspan -&gt; mcache -&gt; mcentral -&gt; mheap -&gt; heapArena。golang中对象的内存分配流程如下：</p>
<ol>
<li>小于16个字节的对象使用<code>mcache</code>的微对象分配器进行分配内存</li>
<li>大小在16个字节到32k字节之间的对象，首先计算出需要使用的<code>span</code>大小规格，然后使用<code>mcache</code>中相同大小规格的<code>mspan</code>分配</li>
<li>如果对应的大小规格在<code>mcache</code>中没有可用的<code>mspan</code>，则向<code>mcentral</code>申请</li>
<li>如果<code>mcentral</code>中没有可用的<code>mspan</code>，则向<code>mheap</code>申请，并根据BestFit算法找到最合适的<code>mspan</code>。如果申请到的<code>mspan</code>超出申请大小，将会根据需求进行切分，以返回用户所需的页数，剩余的页构成一个新的<code>mspan</code>放回<code>mheap</code>的空闲列表</li>
<li>如果<code>mheap</code>中没有可用<code>span</code>，则向操作系统申请一系列新的页（最小 1MB）</li>
<li>对于大于32K的大对象直接从<code>mheap</code>分配</li>
</ol>
<p>mspan:</p>
<p>mspan是一个双向链表结构。mspan是golang中内存分配管理的基本单位。span大小一共有67个规格。规格列表如下， 其中class = 0 是特殊的span，用于大于32kb对象分配，是直接从mheap上分配的。</p>
<p>mcache:</p>
<p>mcache持有一系列不同大小的mspan。mcache属于per-P cache，由于M运行G时候，必须绑定一个P，这样当G中申请从mcache分配对象内存时候，无需加锁处理。</p>
<p>mcetral:</p>
<p>当mcache的中没有可用的span时候，会向mcentral申请。</p>
<h3 id="go_8">Go错误处理<a class="headerlink" href="#go_8" title="Permanent link">&para;</a></h3>
<p>为了不丢失函数调用的错误链，使用<code>fmt.Errorf</code>时搭配使用特殊的格式化动词<code>%w</code>，可以实现基于已有的错误再包装得到一个新的错误。</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;查询数据库失败，err:%w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span></code></pre></div>
<p>对于这种二次包装的错误，<code>errors</code>包中提供了以下三个方法。</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Unwrap</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w">                 </span><span class="c1">// 获得err包含下一层错误</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w">              </span><span class="c1">// 判断err是否包含target</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kd">func</span><span class="w"> </span><span class="nx">As</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">bool</span><span class="w">  </span><span class="c1">// 判断err是否为target类型</span>
</span></code></pre></div>
<p><a href="https://www.jb51.net/article/254917.htm">一篇文章带你轻松搞懂Golang的error处理_Golang_脚本之家</a></p>
<h2 id="gojavatry-catch">Go错误处理机制为啥不采用Java的try-catch的异常机制？<a class="headerlink" href="#gojavatry-catch" title="Permanent link">&para;</a></h2>
<p>Go 语言选择不使用 Java 中的异常机制，而是采用返回错误（error）的方式处理异常情况，这主要是基于几个设计目标和考虑：</p>
<ul>
<li>
<p><strong>简明性和可预测性</strong>：在 Go 语言中，错误被视为常见的、可预料的结果，而不是异常情况。通过显式地返回错误，程序员被迫处理错误，这可以使得错误处理更加显式和清晰，减少了忽视错误处理的可能性。</p>
</li>
<li>
<p><strong>控制流简单化</strong>：使用异常机制时，代码的执行流可以因为异常的抛出而在任何点被中断，这使得程序的控制流变得复杂和难以跟踪。相反，通过返回错误，错误处理和正常逻辑清晰地分离，控制流更加直观。</p>
</li>
<li>
<p><strong>性能考虑</strong>：异常处理机制通常涉及栈解 unwinding 过程，这在性能上可能带来开销。Go 语言通过简单的值返回避免了这种开销。</p>
</li>
<li>
<p><strong>交叉语言调用简化</strong>：Go 语言在设计时考虑到了与 C 语言的互操作性。在 C 语言中没有异常机制，使用错误码是常见做法。Go 的错误处理方式与之兼容，简化了跨语言调用的复杂性。</p>
</li>
</ul>
<p>关于是否是一个好的设计，这取决于具体的使用场景和个人偏好。这种设计强化了错误处理的重要性，并鼓励开发者更加关注程序可能出现的错误情况，从而可能增强程序的健壮性。但是，这也可能导致代码中充满大量的错误处理逻辑，有时可能显得冗余。</p>
<p>Java 的异常机制有其优点，特别是在错误需要跨多个调用层级传播时，异常提供了一种非常便捷的方式。然而，它也有一些常见的问题：</p>
<ul>
<li><strong>异常被忽略</strong>：Java 中的异常可以被捕获后不做任何处理，这可能隐藏程序中的错误。</li>
<li><strong>代码复杂性</strong>：异常的抛出和捕获可能使得程序逻辑变得难以理解和维护，特别是当异常可以在多个层级被抛出和捕获时。</li>
<li><strong>性能问题</strong>：异常处理可能引入性能损耗，特别是在异常频繁抛出的场景中。</li>
</ul>
<p>总体来说，Go 的错误处理方式倾向于更加显式和可控，而 Java 的异常机制则提供了一种灵活但有时可能不够清晰的错误处理策略。选择哪种方式更好，很大程度上取决于特定项目的需求和开发团队的偏好。</p>
<h2 id="go_9">Go为什么采用组合机制而不是使用继承机制？<a class="headerlink" href="#go_9" title="Permanent link">&para;</a></h2>
<p>Go 语言没有传统意义上的类和继承机制，这是其设计哲学中的一部分，旨在简化语言和避免常见的面向对象编程的一些复杂性和问题。下面是 Go 语言这样设计的一些原因及其替代方式：</p>
<h3 id="go_10">为什么 Go 没有传统的继承？<a class="headerlink" href="#go_10" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>简化语言设计</strong>：Go 的设计哲学是保持语言的简洁和高效。继承是一个强大但复杂的功能，可以导致多种编程问题，如复杂的依赖关系和难以预测的行为。</p>
</li>
<li>
<p><strong>避免继承带来的问题</strong>：</p>
<ul>
<li><strong>脆弱的基类问题</strong>：基类的改变可能影响到大量的派生类。</li>
<li><strong>深层继承结构导致的复杂性</strong>：随着继承链的增长，理解和维护代码变得更加困难。</li>
<li><strong>多重继承的复杂性</strong>：如 C++ 中的多重继承可能导致菱形继承问题，增加了语言和编译器的复杂性。</li>
</ul>
</li>
</ul>
<h3 id="go_11">Go 如何实现多态？<a class="headerlink" href="#go_11" title="Permanent link">&para;</a></h3>
<p>尽管 Go 没有继承，它通过接口来支持多态性。在 Go 中，接口是一组方法签名的集合，任何类型只要实现了这些方法，就被认为实现了该接口。这种方式与继承不同，更加灵活和简洁：</p>
<ul>
<li><strong>接口隐式实现</strong>：类型不需要声明它实现了哪个接口，这降低了代码之间的耦合。</li>
<li><strong>组合优于继承</strong>：Go 通过组合（有时候通过嵌入结构体）来实现代码的复用，这比继承更加直接和清晰。</li>
</ul>
<h3 id="embedded-struct">Embedded Struct 算不算继承？<a class="headerlink" href="#embedded-struct" title="Permanent link">&para;</a></h3>
<p>Embedded struct（嵌入结构体）在 Go 中被用作实现类似继承的功能，但它更准确地被描述为组合。通过嵌入一个结构体，一个新的结构体可以直接访问嵌入结构体的方法和字段，这提供了一种方式来复用代码：</p>
<ul>
<li><strong>不是真正的继承</strong>：虽然看起来类似，嵌入结构体并不提供传统意义上的多态。</li>
<li><strong>代码复用和扩展</strong>：它允许一种灵活的方式来扩展功能，而无需继承的复杂性。</li>
</ul>
<h3 id="_18">传统继承的问题<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>过度耦合</strong>：子类和父类之间的关系过于紧密，改动父类可能会影响所有子类。</li>
<li><strong>隐藏的复杂性</strong>：继承可以导致代码的行为不透明，增加理解和调试的难度。</li>
<li><strong>难以正确使用</strong>：正确地设计和维护一个继承体系需要大量的设计经验和技术洞察力。</li>
</ul>
<p>Go 的设计选择鼓励开发者采用更简单、更易于理解和维护的编程范式。通过接口和组合，Go 提供了一种强大的工具集来建构灵活且可维护的代码结构，避免了许多传统面向对象编程中常见的陷阱。</p>
<h3 id="go-channel-java-blockingqueue">Go 中 channel 跟 Java 中 BlockingQueue 又有啥区别 ?<a class="headerlink" href="#go-channel-java-blockingqueue" title="Permanent link">&para;</a></h3>
<p>Go 的 channel 和 Java 的 BlockingQueue 都是用于不同线程或协程间的通信机制，但它们的设计哲学和使用场景有所不同。这两种机制都用于解决并发编程中的同步问题，但具体的实现和适用的场景有差异。</p>
<h3 id="channel-blockingqueue">Channel 与 BlockingQueue 的区别<a class="headerlink" href="#channel-blockingqueue" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>设计哲学：</p>
<ul>
<li>Go 的 Channel：Channel 是 Go 语言中的一等公民，用于在协程（goroutines）之间进行通信。它遵循“通过通信来共享内存，而不是通过共享内存来通信”的哲学。</li>
<li>Java 的 BlockingQueue：是 Java 并发包中的一部分，主要用于线程间的通信，尤其在生产者-消费者模型中。它依赖于共享内存和锁来实现线程安全。</li>
</ul>
</li>
<li>
<p>功能实现：</p>
<ul>
<li>Channel 支持多种模式，如无缓冲、有缓冲通道，可以非常灵活地控制协程间的数据流和同步。</li>
<li>BlockingQueue 是一个接口，Java 提供了多种实现（如 ArrayBlockingQueue, LinkedBlockingQueue），主要通过阻塞操作来实现生产者和消费者之间的同步。</li>
</ul>
</li>
<li>
<p>用途和应用场景：</p>
<ul>
<li>Channel 通常用于协程间的信号传递和数据交换，特别是在需要控制并发操作顺序时。</li>
<li>BlockingQueue 通常用于处理较大的数据流或者在多线程环境下缓存数据。</li>
</ul>
</li>
</ol>
<h3 id="vs-channel">共享内存并发 vs. Channel 并发<a class="headerlink" href="#vs-channel" title="Permanent link">&para;</a></h3>
<h4 id="_19">共享内存并发<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<ul>
<li>适用场景：适合复杂的数据结构共享，或者当有多个线程需要访问和修改同一数据时。在多核处理器上，这种方式可以有效利用缓存一致性协议。</li>
<li>优点：可以实现细粒度的控制，对于某些高性能计算场景可以更直接地管理内存。</li>
<li>缺点：容易产生竞态条件，编程模型更加复杂，需要精确地控制锁和同步。</li>
</ul>
<h4 id="channel_1">Channel 并发<a class="headerlink" href="#channel_1" title="Permanent link">&para;</a></h4>
<ul>
<li>适用场景：适合事件驱动或消息驱动的应用，如网络服务或并行数据处理。在这些场景中，通信模式清晰，各部分之间的解耦更彻底。</li>
<li>优点：简化了并发和同步的管理，代码通常更易于理解和维护。</li>
<li>缺点：在极端的高性能需求下，可能会因为消息传递的开销而不如直接的内存访问高效。</li>
</ul>
<h4 id="_20">选择建议<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<ul>
<li>如果问题适合通过明确的消息传递进行模块化设计，或者当系统的可维护性和清晰的并发模型比原始性能更重要时，使用 Channel。</li>
<li>如果需要最大限度地控制性能，并且可以管理更复杂的同步策略和竞态风险，使用共享内存可能更合适。</li>
</ul>
<p>在实际开发中，选择合适的并发策略依赖于具体问题、性能需求和团队的熟悉度。对于维护性和开发效率有较高要求的项目，Channel 往往是一个更易于管理的选择。</p>
<h2 id="_21">资料<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h2>
<p><a href="https://zhuanlan.zhihu.com/p/574580955">【Golang开发面经】蔚来（两轮技术面）</a></p>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-06-07</span>
      
    
  </small>
</div>


  




                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../container/namespace/" class="md-footer__link md-footer__link--prev" aria-label="上一页: namespace">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                namespace
              </div>
            </div>
          </a>
        
        
          
          <a href="../../jupyter/Go-Frameworks-Github-Fork-Stats/" class="md-footer__link md-footer__link--next" aria-label="下一页: Go-Frameworks-Github-Fork-Stats">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Go-Frameworks-Github-Fork-Stats
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2024 Tink
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/squidfunk" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/r/squidfunk/mkdocs-material/" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/mkdocs-material/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
      
    
    
    
      
      
    
    <a href="https://fosstodon.org/@squidfunk" target="_blank" rel="noopener me" title="fosstodon.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/squidfunk" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>